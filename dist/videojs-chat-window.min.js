!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsChatWindow=t(e.videojs)}(this,function(e){"use strict";const t=e.getPlugin("plugin");class s extends t{constructor(t,s={}){super(t,s),this.options_=s,this.isVisible=!1,t.ready(()=>{t.controlBar&&t.controlBar.pictureInPictureToggle&&t.controlBar.pictureInPictureToggle.hide(),this.container||(this.container=e.dom.createEl("div",{className:"vjs-chat-window"}),this.messages=e.dom.createEl("div",{className:"vjs-chat-messages"}),this.messages.setAttribute("role","log"),this.messages.setAttribute("aria-live","polite"),this.input=e.dom.createEl("input",{className:"vjs-chat-input",type:"text",placeholder:s.placeholder||"Type a messageâ€¦"}),this.input.setAttribute("aria-label","Chat input"),this.container.appendChild(this.messages),this.container.appendChild(this.input),t.controlBar.el().appendChild(this.container),this._onKeyDown=e=>{"Enter"===e.key&&this.input.value.trim()&&(this.addMessage(s.username||"You",this.input.value.trim()),this.input.value="")},this.input.addEventListener("keydown",this._onKeyDown)),this.addToggleButton(t),this.on(t,"dispose",()=>this.dispose())})}addToggleButton(t){const s=e.getComponent("Button"),i=this;const n=t.controlBar;if(!n)return;const o=new class extends s{constructor(e,t){super(e,t),this.controlText("Chat"),this.addClass("vjs-chat-toggle");const s=this.el().querySelector(".vjs-icon-placeholder");s&&(s.innerHTML='\n            <svg viewBox="0 0 24 24" width="18" height="18"\n                 stroke="currentColor" fill="none" stroke-width="2"\n                 stroke-linecap="round" stroke-linejoin="round"\n                 style="pointer-events:none">\n              <path d="M12 22l3-3h3a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3H6A3 3 0 0 0 3 5v11a3 3 0 0 0 3 3h3l3 3z" />\n              <path d="M8 9h8" />\n              <path d="M8 13h5" />\n            </svg>\n          ')}handleClick(){i.toggleChat()}}(t),a=n.getChild("FullscreenToggle")||n.getChild("fullscreenToggle");if(a){const e=n.children().indexOf(a);n.addChild(o,{},e)}else n.addChild(o)}toggleChat(){this.isVisible=!this.isVisible,this.container&&(this.container.style.display=this.isVisible?"flex":"none"),this.isVisible&&(this.messages.scrollTop=this.messages.scrollHeight,this.input&&this.input.focus())}addMessage(t,s){if(!this.messages)return;const i=e.dom.createEl("div",{className:"vjs-chat-message",innerHTML:'<strong class="vjs-chat-user"></strong><span class="vjs-chat-text"></span>'});i.querySelector(".vjs-chat-user").textContent=`${t}: `,i.querySelector(".vjs-chat-text").textContent=s,this.messages.appendChild(i),this.messages.scrollTop=this.messages.scrollHeight}dispose(){this.input&&this._onKeyDown&&this.input.removeEventListener("keydown",this._onKeyDown),this.container?.parentNode&&this.container.parentNode.removeChild(this.container),super.dispose()}}return e.registerPlugin("chatWindow",function(e){return this.chatWindow_||(this.chatWindow_=new s(this,e)),this.chatWindow_}),s});
